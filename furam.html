<!doctype html>
<html>
<title>SUPA</title>
<head>
<link rel="stylesheet" type="text/css" media="all" href="css/reset.css" /> <!-- reset css -->
<script src="jquery.min.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>


<!--[if lt IE 9]><script type="text/javascript" src="../excanvas.js"></script><![endif]-->

<style>
    body{ background-color: ivory; }
    canvas{border:1px solid red;}
</style>

<script>
var coordonate=[];
var coordonatex=[]
var coordonatey=[];
	  var i=0;
	  var text="";
var obj={};
var vect = [];
var ourObj = {};
coordonate[i]=";";
i++;
var nr=0;
$(function(){
	
	
	
    var canvas=document.getElementById("canvas");
    var ctx=canvas.getContext("2d");
    var lastX;
    var lastY;
    var strokeColor="red";
    var strokeWidth=2;
    var mouseX;
    var mouseY;
    var canvasOffset=$("#canvas").offset();
    var offsetX=canvasOffset.left;
    var offsetY=canvasOffset.top;
    var isMouseDown=false;


    function handleMouseDown(e){
      mouseX=parseInt(e.clientX-offsetX);
      mouseY=parseInt(e.clientY-offsetY);

      // Put your mousedown stuff here
	  
	  
	  
	  
		
		
      lastX=mouseX;
      lastY=mouseY;
      isMouseDown=true;
    }

    function handleMouseUp(e){
      mouseX=parseInt(e.clientX-offsetX);
      mouseY=parseInt(e.clientY-offsetY);

      // Put your mouseup stuff here
	  coordonate[i]=";";
		i++;
      isMouseDown=false;
    }

    function handleMouseOut(e){
      mouseX=parseInt(e.clientX-offsetX);
      mouseY=parseInt(e.clientY-offsetY);

      // Put your mouseOut stuff here
	  
	  
	  if (isMouseDown){

	  function exportToCsv() {
            var myCsv = coordonate;

            window.open('data:text/csv;charset=utf-8,' + escape(myCsv));
        }
		
	
        var button = document.getElementById('b');
        button.addEventListener('click', exportToCsv);
		}
		}
		

      isMouseDown=false;
    

	
	
    function handleMouseMove(e){
      mouseX=parseInt(e.clientX-offsetX);
      mouseY=parseInt(e.clientY-offsetY);

      //Put your mouseMove stuff here
	  
	  if (isMouseDown){
		if (mode=="pen"){
		coordonate[i]=mouseX;text +=coordonate[i]+" ";i++;
		coordonate[i]=(810-mouseY);text +=coordonate[i]+"<br>";i++;
	  var coords = "X coords: " + mouseX + ", Y coords: " +(810-mouseY);
	document.getElementById("demo").innerHTML = coords;
	//document.getElementById("vector").innerHTML = text;
	}}
		/*if (isMouseDown){
		if (mode=="eraser")
		{
			coordonatex[mouseX]=1;
			coordonatey[(810-mouseY)]=1;
		}
		}*/
	
      if(isMouseDown){
          ctx.beginPath();
          if(mode=="pen"){
              ctx.globalCompositeOperation="source-over";
              ctx.moveTo(lastX,lastY);
              ctx.lineTo(mouseX,mouseY);
              ctx.stroke();     
          }else{
              ctx.globalCompositeOperation="destination-out";
              ctx.arc(lastX,lastY,5,0,Math.PI*2,false);
              ctx.fill();
          }
          lastX=mouseX;
          lastY=mouseY;
      }
    }

    $("#canvas").mousedown(function(e){handleMouseDown(e);});
    $("#canvas").mousemove(function(e){handleMouseMove(e);});
    $("#canvas").mouseup(function(e){handleMouseUp(e);});
    $("#canvas").mouseout(function(e){handleMouseOut(e);});

    var mode="pen";
    $("#pen").click(function(){ mode="pen"; });
    $("#eraser").click(function(){ mode="eraser"; });

});

	//end $(function(){});

function dacadauclick(){
ourObj.data = coordonate;
ourObj.lungime = coordonate.length;

$.ajax({
   url: "datejs.php",
   type: "POST",
   async: false,
   data: { "points" : JSON.stringify(ourObj) },
   
   success: function(data) {
		alert("\n   AJAX CALLED \n" + data );},
   error: function(xhr, ajaxOptions, thrownError) {
	alert( xhr.responseText + " " + xhr.responseText+ " "+ thrownError +" cacaaaaa"); 
   }
});

}

 
</script>
<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
 
</head>

<body>
    <canvas id="canvas" width=780 height=810></canvas></br>
    <button id="pen">Pen</button>
    <!--<button id="eraser">Eraser</button>-->
	<!--<input id="clickMe" type="button" value="Eraser" onclick="location.reload();" />-->





	<button onclick="location.reload();">Eraser</button>
	<button id="demo">Coordonate</button>
<!--	<button id="b">Download</button>-->
	<p id="vector"></p><tr>
<script language="JavaScript" type="text/JavaScript">

function MM_openBrWindow(theURL,winName,features) {
window.open(theURL,winName,features);
  

}
</script>
 <input type="button" value="Trimite" onClick="dacadauclick()"/>
    <td width="393" height="173">
      <form id="form1" name="form1" method="post" action="">
        <input type="submit" name="Scrie" id="1" value="TURBO" onClick="MM_openBrWindow('actionare.php?com=1','','width=500,height=400,valign=center ')">

<!--  <form action="merge.php" method="get">
<input type="submit" value="Run me now!">
</form>-->

<!--<input type="submit" name="Deschidere" id="2" value="Inchidere" onClick="MM_openBrWindow('actionare.php?com=2','','width=500,height=100,valign=center ')">
 <!-- <input type="submit" name="Automat" id="3" value="Automat" onClick="MM_openBrWindow('actionare.php?com=3','','width=500,height=200,valign=center ')">-->
    <!--    <input type="submit" name="Pauza" id="4" value = "Pauza" onClick="MM_openBrWindow('actionare.php?com=4','','width=500,height=100,valign=center ')">-->
  </form></td>


 <!--<button onClick="shell_exec(\'sudo python baza2.py\')">Click aci </button>-->
<!--<div id="gamepadPrompt"></div>
    <div id="gamepadDisplay"></div>
 
    <script>
    var hasGP = false;
    var repGP;
 
    function canGame() {
        return "getGamepads" in navigator;
    }
 
    function reportOnGamepad() {
        var gp = navigator.getGamepads()[0];
        var html = "";
            html += "id: "+gp.id+"<br/>";
 
        for(var i=0;i<gp.buttons.length;i++) {
            html+= "Button "+(i+1)+": ";
            if(gp.buttons[i].pressed) html+= " pressed";
            html+= "<br/>";
        }
 
        for(var i=0;i<gp.axes.length; i+=2) {
            html+= "Stick "+(Math.ceil(i/2)+1)+": "+gp.axes[i]+","+gp.axes[i+1]+"<br/>";
        }
 
        $("#gamepadDisplay").html(html);
    }
 
    $(document).ready(function() {
 
        if(canGame()) {
 
            var prompt = "To begin using your gamepad, connect it and press any button!";
            $("#gamepadPrompt").text(prompt);
 
            $(window).on("gamepadconnected", function() {
                hasGP = true;
                $("#gamepadPrompt").html("Gamepad connected!");
                console.log("connection event");
                repGP = window.setInterval(reportOnGamepad,100);
            });
 
            $(window).on("gamepaddisconnected", function() {
                console.log("disconnection event");
                $("#gamepadPrompt").text(prompt);
                window.clearInterval(repGP);
            });
 
            //setup an interval for Chrome
            var checkGP = window.setInterval(function() {
                console.log('checkGP');
                if(navigator.getGamepads()[0]) {
                    if(!hasGP) $(window).trigger("gamepadconnected");
                    window.clearInterval(checkGP);
                }
            }, 500);
        }
 
    });
    </script>-->

</body>
</html>
